{% extends 'admin/master.html' %}
{% block body %}
<head>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
  body {
    background-color: #fff5f8; /* n·ªÅn h·ªìng r·∫•t nh·∫°t */
    font-family: 'Poppins', sans-serif;
    color: #444;
    padding: 20px;
    min-height: 100vh;
  }

  h2 {
    font-weight: 600;
    font-size: 1.8rem;
    color: #e91e63; /* h·ªìng ƒë·∫≠m */
    margin-bottom: 1.5rem;
  }

  /* Card th·ªëng k√™ */
  .card {
    border-radius: 10px;
    border: none;
    background-color: #fff;
    box-shadow: 0 4px 8px rgba(233, 30, 99, 0.15);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    padding: 1.2rem;
    text-align: center;
  }
  .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 14px rgba(233, 30, 99, 0.25);
  }
  .card-title {
    font-weight: 500;
    color: #e91e63;
    font-size: 0.95rem;
    text-transform: uppercase;
    margin: 0.5rem 0;
  }
  .card h3 {
    font-weight: 700;
    font-size: 1.8rem;
    color: #c2185b;
    margin: 0;
  }

  /* Dropdown */
  .form-select-sm {
    font-size: 0.85rem;
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    border: 1.5px solid #f8bbd0;
    color: #e91e63;
    background-color: #fff;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .form-select-sm:focus {
    border-color: #e91e63;
    box-shadow: 0 0 5px rgba(233, 30, 99, 0.3);
    outline: none;
  }

  /* Chart */
  canvas {
    width: 100% !important;
    max-height: 350px;
  }
    body {
  background: linear-gradient(180deg, #ffe6ee 0%, #fff 100%);
  font-family: 'Poppins', sans-serif;
  color: #444;
  padding: 20px;
  min-height: 100vh;
}

/* Ti√™u ƒë·ªÅ */
h2 {
  font-weight: 700;
  font-size: 2rem;
  color: #d81b60;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
}
h2::before {

  margin-right: 10px;
}

/* Card */
.card {
  border-radius: 15px;
  border: none;
  background: #fff;
  box-shadow: 0 6px 15px rgba(216, 27, 96, 0.15);
  transition: all 0.3s ease;
  padding: 1.2rem;
  text-align: center;
  opacity: 0;
  transform: scale(0.95);
  animation: fadeInZoom 0.5s forwards;
}
.card:hover {
  background: linear-gradient(145deg, #fff, #ffe6f0);
  box-shadow: 0 10px 20px rgba(216, 27, 96, 0.25);
  transform: translateY(-5px);
}
.card-title {
  font-weight: 600;
  color: #d81b60;
  font-size: 1rem;
  text-transform: uppercase;
  margin: 0.5rem 0;
}
.card h3 {
  font-weight: 700;
  font-size: 2rem;
  color: #ad1457;
  margin: 0;
}
.icon {
  width: 50px;
  height: 50px;
  margin-bottom: 0.5rem;
}

/* Dropdown */
.form-select-sm {
  font-size: 0.9rem;
  padding: 0.3rem 0.7rem;
  border-radius: 12px;
  border: 1.5px solid #f48fb1;
  color: #d81b60;
  background-color: #fff;
  cursor: pointer;
  transition: all 0.2s ease;
}
.form-select-sm:hover {
  background: #fce4ec;
}
.form-select-sm:focus {
  border-color: #d81b60;
  box-shadow: 0 0 5px rgba(216, 27, 96, 0.3);
  outline: none;
}

/* Animation */
@keyframes fadeInZoom {
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* Chart */
canvas {
  width: 100% !important;
  max-height: 350px;
}
</style>

</head>

<div class="container-fluid">
  <h2 class="mb-3">Dashboard</h2>
  {% if pending_count > 0 %}
<div class="alert alert-warning shadow-sm" role="alert">
  üîî C√≥ <strong>{{ pending_count }}</strong> s·ª± ki·ªán ƒëang ch·ªù duy·ªát!
  <a href="{{ url_for('admin_view.approve_events') }}" class="alert-link">Xem ngay</a>
</div>
{% endif %}

  <!-- Cards th·ªëng k√™ t·ªïng -->
  <div class="row">
    {% set icons = {
      'USER': '<svg xmlns="http://www.w3.org/2000/svg" fill="#1976d2" viewBox="0 0 24 24" class="icon"><path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/></svg>',
      'CUSTOMER': '<svg xmlns="http://www.w3.org/2000/svg" fill="#ff9800" viewBox="0 0 24 24" class="icon"><path d="M16 11c1.7 0 3-1.3 3-3s-1.3-3-3-3 -3 1.3-3 3 1.3 3 3 3zm-8 0c1.7 0 3-1.3 3-3S9.7 5 8 5 5 6.3 5 8s1.3 3 3 3zm0 2c-2.7 0-8 1.3-8 4v2h6v-2c0-0.7 0.2-1.3 0.6-1.8C9 14.6 10.5 14 12 14c1.5 0 3 0.6 3.4 1.2 0.4 0.5 0.6 1.1 0.6 1.8v2h6v-2C22 14.3 17.7 13 16 13H8z"/></svg>',
      'EVENT ORGANIZER': '<svg xmlns="http://www.w3.org/2000/svg" fill="#4caf50" viewBox="0 0 24 24" class="icon"><path d="M19 4h-1V2h-2v2H8V2H6v2H5C3.9 4 3 4.9 3 6v14c0 1.1 0.9 2 2 2h14c1.1 0 2-0.9 2-2V6C21 4.9 20.1 4 19 4zm0 16H5V9h14v11z"/></svg>',
      'EVENT ONLINE': '<svg xmlns="http://www.w3.org/2000/svg" fill="#00bcd4" viewBox="0 0 24 24" class="icon"><path d="M21 6h-2V4c0-1.1-0.9-2-2-2H7C5.9 2 5 2.9 5 4v2H3c-1.1 0-2 0.9-2 2v11c0 1.1 0.9 2 2 2h18c1.1 0 2-0.9 2-2V8C23 6.9 22.1 6 21 6zM7 4h10v2H7V4z"/></svg>',
      'EVENT OFFLINE': '<svg xmlns="http://www.w3.org/2000/svg" fill="#9c27b0" viewBox="0 0 24 24" class="icon"><path d="M4 6V4h16v2H4zm0 4V8h16v2H4zm0 4v-2h16v2H4zm0 4v-2h10v2H4z"/></svg>',
      'BOOKING': '<svg xmlns="http://www.w3.org/2000/svg" fill="#e91e63" viewBox="0 0 24 24" class="icon"><path d="M17 4h-3V2H10v2H7c-1.1 0-2 0.9-2 2v14c0 1.1 0.9 2 2 2h10c1.1 0 2-0.9 2-2V6C19 4.9 18.1 4 17 4zM7 20V6h10v14H7z"/></svg>'
    } %}

    {% for name, count in counts_summary.items() %}
    <div class="col-md-3 mb-3">
      <div class="card shadow-sm">
        <div class="card-body">
          {{ icons[name]|safe }}
          <h5 class="card-title">{{ name }}</h5>
          <h3>{{ count }}</h3>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Bi·ªÉu ƒë·ªì -->
  <div class="row">
    <div class="col-md-6">
      <div class="d-flex mb-2">
        <h5>Th·ªëng k√™ s·ª± ki·ªán theo lo·∫°i</h5>
        <select id="eventChartType" class="form-select form-select-sm">
          <option value="doughnut">Doughnut</option>
          <option value="pie">Pie</option>
          <option value="bar">Bar</option>
          <option value="line">Line</option>
        </select>
      </div>
      <canvas id="eventChart"></canvas>
    </div>

    <div class="col-md-6">
      <div class="d-flex mb-2">
        <h5>Th·ªëng k√™ user theo vai tr√≤</h5>
        <select id="userChartType" class="form-select form-select-sm">
          <option value="bar">Bar</option>
          <option value="doughnut">Doughnut</option>
          <option value="pie">Pie</option>
          <option value="line">Line</option>
        </select>
      </div>
      <canvas id="userChart"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const eventLabels = {{ event_labels|tojson }};
  const eventData = {{ event_data|tojson }};
  const userLabels = {{ user_labels|tojson }};
  const userData = {{ user_data|tojson }};

  const ctxEvent = document.getElementById('eventChart').getContext('2d');
  let eventChart = new Chart(ctxEvent, {
    type: 'doughnut',
    data: {
      labels: eventLabels,
      datasets: [{ data: eventData, backgroundColor: ['#36A2EB','#FF6384','#FFCE56','#4BC0C0'] }]
    }
  });

  const ctxUser = document.getElementById('userChart').getContext('2d');
  let userChart = new Chart(ctxUser, {
    type: 'bar',
    data: {
      labels: userLabels,
      datasets: [{ data: userData, backgroundColor: ['#36A2EB','#FF6384','#FFCE56'] }]
    }
  });

  document.getElementById('eventChartType').addEventListener('change', function() {
    eventChart.config.type = this.value;
    eventChart.update();
  });

  document.getElementById('userChartType').addEventListener('change', function() {
    userChart.config.type = this.value;
    userChart.update();
  });
</script>
{% endblock %}