<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh ToÃ¡n - Há»‡ Thá»‘ng Äáº·t VÃ©</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='images/icons8-ticket-50.png') }}" type="image/png">
</head>
<body>
<div class="payment-container">
    <div class="payment-header">
        <h1>ğŸ’³ Thanh ToÃ¡n</h1>
        <p>Vui lÃ²ng chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n phÃ¹ há»£p</p>
    </div>

    <div class="order-summary">
        <h3>ğŸ“‹ TÃ³m Táº¯t ÄÆ¡n HÃ ng</h3>
        <div class="order-details">
            <div class="order-detail">
                <span>Sá»± kiá»‡n:</span>
                <span>{{ event.name }}</span>
            </div>
            <div class="order-detail">
                <span>NgÃ y:</span>
                <span>{{ event.start_datetime.strftime('%d/%m/%Y %H:%M') if event.start_datetime else 'ChÆ°a cÃ³ thÃ´ng tin' }}</span>
            </div>
            <div class="order-detail">
                <span>Sá»‘ gháº¿ Ä‘Ã£ chá»n:</span>
                <span>{{ selected_seats|length }} gháº¿</span>
            </div>
            <div class="order-detail">
                <span>Gháº¿:</span>
                <span>{% for seat in selected_seats %}{% if seat is mapping %}{{ seat.id }}{% else %}{{ seat }}{% endif %}{% if not loop.last %}, {% endif %}{% endfor %}</span>
            </div>
        </div>
        <div class="total-amount">
            Tá»•ng tiá»n: {{ "{:,.0f}".format(total_amount) }} VNÄ
        </div>
    </div>

    <div class="payment-methods">
        <h3>ğŸ¦ PhÆ°Æ¡ng Thá»©c Thanh ToÃ¡n</h3>
        <div class="payment-options">

            <div class="payment-option" data-method="bank">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjMzQ5OGRiIi8+CjxwYXRoIGQ9Ik0xMCAxNUg1MFYyNUgxMFYxNVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xMCAzMEg1MFY0MEgxMFYzMFoiIGZpbGw9IndoaXRlIi8+CjxjaXJjbGUgY3g9IjMwIiBjeT0iMjAiIHI9IjMiIGZpbGw9IiMzNDk4ZGIiLz4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzNSIgcj0iMyIgZmlsbD0iIzM0OThkYiIvPgo8L3N2Zz4K"
                     alt="Bank Transfer">
                <h4>Chuyá»ƒn Khoáº£n NgÃ¢n HÃ ng</h4>
                <p>Chuyá»ƒn khoáº£n trá»±c tiáº¿p qua ngÃ¢n hÃ ng</p>
            </div>

            <div class="payment-option" data-method="momo">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjQzYxNEY2Ii8+CjxwYXRoIGQ9Ik0zMCAxNUMyMS43MTYgMTUgMTUgMjEuNzE2IDE1IDMwQzE1IDM4LjI4NCAyMS43MTYgNDUgMzAgNDVDMzguMjg0IDQ1IDQ1IDM4LjI4NCA0NSAzMEM0NSAyMS43MTYgMzguMjg0IDE1IDMwIDE1Wk0zMCA0MEMyNC40NzcgNDAgMjAgMzUuNTIzIDIwIDMwQzIwIDI0LjQ3NyAyNC40NzcgMjAgMzAgMjBDMzUuNTIzIDIwIDQwIDI0LjQ3NyA0MCAzMEM0MCAzNS41MjMgMzUuNTIzIDQwIDMwIDQwWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTI1IDI1SDM1VjM1SDI1VjI1WiIgZmlsbD0iI0M2MTRGNiIvPgo8L3N2Zz4K"
                     alt="MOMO">
                <h4>MOMO</h4>
                <p>Thanh toÃ¡n qua vÃ­ Ä‘iá»‡n tá»­ MOMO</p>
            </div>
        </div>
    </div>

    <!-- QR Code Section -->
    <div class="qr-section" id="qr-section">
        <h3>ğŸ“± QuÃ©t MÃ£ QR Äá»ƒ Thanh ToÃ¡n</h3>
        <div class="payment-instructions">
            <h4>HÆ°á»›ng dáº«n thanh toÃ¡n:</h4>
            <ul>
                <li>Má»Ÿ á»©ng dá»¥ng ngÃ¢n hÃ ng trÃªn Ä‘iá»‡n thoáº¡i</li>
                <li>Chá»n tÃ­nh nÄƒng "QuÃ©t mÃ£ QR"</li>
                <li>QuÃ©t mÃ£ QR bÃªn dÆ°á»›i</li>
                <li>Kiá»ƒm tra thÃ´ng tin vÃ  xÃ¡c nháº­n thanh toÃ¡n</li>
            </ul>
        </div>
        <div class="qr-code">
            <img src="{{ qr_img_url }}" alt="QR Code thanh toÃ¡n" style="width: 200px; height: 200px;"/>
        </div>
        <p><strong>LÆ°u Ã½:</strong> Sau khi thanh toÃ¡n thÃ nh cÃ´ng, vÃ© sáº½ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n</p>
    </div>

    <!-- Bank Transfer Section -->
    <div class="bank-info" id="bank-info">
        <h3>ğŸ¦ ThÃ´ng Tin Chuyá»ƒn Khoáº£n</h3>
        <div class="payment-instructions">
            <h4>HÆ°á»›ng dáº«n chuyá»ƒn khoáº£n:</h4>
            <ul>
                <li>Sao chÃ©p thÃ´ng tin tÃ i khoáº£n bÃªn dÆ°á»›i</li>
                <li>Chuyá»ƒn khoáº£n chÃ­nh xÃ¡c sá»‘ tiá»n: {{ "{:,.0f}".format(total_amount) }} VNÄ</li>
                <li>Ná»™i dung chuyá»ƒn khoáº£n: "VE_{{ event.id }}_{{ current_user.id }}"</li>
                <li>Sau khi chuyá»ƒn khoáº£n, vÃ© sáº½ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n</li>
            </ul>
        </div>
        <div class="bank-details">
            <div class="bank-detail">
                <span>NgÃ¢n hÃ ng:</span>
                <span>Vietcombank</span>
            </div>
            <div class="bank-detail">
                <span>Sá»‘ tÃ i khoáº£n:</span>
                <span>1234567890 <button class="copy-btn"
                                         onclick="copyToClipboard('1234567890')">Sao chÃ©p</button></span>
            </div>
            <div class="bank-detail">
                <span>Chá»§ tÃ i khoáº£n:</span>
                <span>CÃ”NG TY TNHH Äáº¶T VÃ‰ ONLINE</span>
            </div>
            <div class="bank-detail">
                <span>Sá»‘ tiá»n:</span>
                <span>{{ "{:,.0f}".format(total_amount) }} VNÄ</span>
            </div>
            <div class="bank-detail">
                <span>Ná»™i dung:</span>
                <span>VE_{{ event.id }}_{{ current_user.id }} <button class="copy-btn"
                                                                      onclick="copyToClipboard('VE_{{ event.id }}_{{ current_user.id }}')">Sao chÃ©p</button></span>
            </div>
        </div>
        <div class="qr-code" style="margin-top: 20px;">
            <img src="{{ qr_img_url_bank }}" alt="QR Code chuyá»ƒn khoáº£n" style="width: 200px; height: 200px;"/>
<!--            <div><small>QuÃ©t mÃ£ nÃ y Ä‘á»ƒ chuyá»ƒn khoáº£n nhanh</small></div>-->
        </div>
    </div>

    <!-- MOMO Section -->
    <div class="qr-section" id="momo-section">
        <h3>ğŸ’œ Thanh ToÃ¡n Qua MOMO</h3>
        <div class="payment-instructions">
            <h4>HÆ°á»›ng dáº«n thanh toÃ¡n:</h4>
            <ul>
                <li>Má»Ÿ á»©ng dá»¥ng MOMO trÃªn Ä‘iá»‡n thoáº¡i</li>
                <li>Chá»n "QuÃ©t mÃ£ QR" hoáº·c "Thanh toÃ¡n"</li>
                <li>QuÃ©t mÃ£ QR bÃªn dÆ°á»›i</li>
                <li>XÃ¡c nháº­n thÃ´ng tin vÃ  hoÃ n táº¥t thanh toÃ¡n</li>
            </ul>
        </div>
        <div class="qr-code">
            <img src="{{ qr_img_url_momo }}" alt="QR Code MOMO" style="width: 200px; height: 200px;"/>
        </div>
        <p><strong>LÆ°u Ã½:</strong> Sau khi thanh toÃ¡n thÃ nh cÃ´ng, vÃ© sáº½ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n</p>
    </div>

    <div class="payment-actions">
        <button class="btn-pay" onclick="confirmPayment()">âœ… XÃ¡c Nháº­n Thanh ToÃ¡n</button>
        <button class="btn-cancel" onclick="cancelPayment()">âŒ Há»§y Bá»</button>
    </div>
</div>

<script>
    let selectedMethod = null;

    // Xá»­ lÃ½ chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n
    document.querySelectorAll('.payment-option').forEach(option => {
        option.addEventListener('click', function() {
            // Bá» chá»n táº¥t cáº£
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Chá»n phÆ°Æ¡ng thá»©c nÃ y
            this.classList.add('selected');
            selectedMethod = this.dataset.method;

            // áº¨n táº¥t cáº£ section
            document.getElementById('qr-section').classList.remove('active');
            document.getElementById('bank-info').classList.remove('active');
            document.getElementById('momo-section').classList.remove('active');

            // Hiá»ƒn thá»‹ section tÆ°Æ¡ng á»©ng
            if (selectedMethod === 'qr') {
                document.getElementById('qr-section').classList.add('active');
            } else if (selectedMethod === 'bank') {
                document.getElementById('bank-info').classList.add('active');
            } else if (selectedMethod === 'momo') {
                document.getElementById('momo-section').classList.add('active');
            }
        });
    });

    // Sao chÃ©p vÃ o clipboard
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function() {
            alert('ÄÃ£ sao chÃ©p: ' + text);
        }, function(err) {
            console.error('Lá»—i khi sao chÃ©p: ', err);
        });
    }

    // XÃ¡c nháº­n thanh toÃ¡n
    function confirmPayment() {
        if (!selectedMethod) {
            alert('Vui lÃ²ng chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n!');
            return;
        }

        const paymentData = {
            event_id: {{ event.id }},
            selected_seats: {{ selected_seats|tojson }},
            total_amount: {{ total_amount }},
            payment_method: selectedMethod
        };

        fetch('/process-payment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(paymentData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Thanh toÃ¡n thÃ nh cÃ´ng! VÃ© Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n.');
                window.location.href = '{{ url_for("events.my_tickets") }}';
            } else {
                alert('Lá»—i: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Lá»—i:', error);
            alert('CÃ³ lá»—i xáº£y ra khi xá»­ lÃ½ thanh toÃ¡n!');
        });
    }

    // Há»§y thanh toÃ¡n
    function cancelPayment() {
        if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n há»§y thanh toÃ¡n?')) {
            window.location.href = '{{ url_for("events.home") }}';
        }
    }
</script>

<!-- Footer -->
<footer class="footer">
    <div class="footer-content">
        <div class="footer-section">
            <h3>Há»‡ Thá»‘ng Äáº·t VÃ© Online</h3>
            <p>Giáº£i phÃ¡p Ä‘áº·t vÃ© trá»±c tuyáº¿n hiá»‡n Ä‘áº¡i vÃ  tiá»‡n lá»£i</p>
            <p>Há»— trá»£ Ä‘áº·t vÃ© cho cÃ¡c sá»± kiá»‡n, concert, vÃ  show diá»…n</p>
        </div>

        <div class="footer-section">
            <h4>LiÃªn Há»‡</h4>
            <p>ğŸ“§ Email: info@ticketing.com</p>
            <p>ğŸ“ Hotline: 1900-xxxx</p>
            <p>ğŸ¢ Äá»‹a chá»‰: 123 ÄÆ°á»ng ABC, Quáº­n 1, TP.HCM</p>
        </div>

        <div class="footer-section">
            <h4>Há»— Trá»£</h4>
            <p>â“ HÆ°á»›ng dáº«n sá»­ dá»¥ng</p>
            <p>ğŸ“‹ Äiá»u khoáº£n sá»­ dá»¥ng</p>
            <p>ğŸ”’ ChÃ­nh sÃ¡ch báº£o máº­t</p>
            <p>ğŸ’³ HÆ°á»›ng dáº«n thanh toÃ¡n</p>
        </div>
    </div>

    <div class="footer-bottom">
        <p>Â© 2024 Há»‡ Thá»‘ng Äáº·t VÃ© Online. Táº¥t cáº£ quyá»n Ä‘Æ°á»£c báº£o lÆ°u.</p>
        <p>PhÃ¡t triá»ƒn bá»Ÿi Team Ticketing System</p>
    </div>
</footer>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html> 