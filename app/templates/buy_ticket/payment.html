<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh To√°n - H·ªá Th·ªëng ƒê·∫∑t V√©</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='images/icons8-ticket-50.png') }}" type="image/png">
</head>
<body>
<div class="payment-container">
    <div class="payment-header">
        <h1>üí≥ Thanh To√°n</h1>
        <p>Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n ph√π h·ª£p</p>
    </div>

    <div class="order-summary">
        <h3>üìã T√≥m T·∫Øt ƒê∆°n H√†ng</h3>
        <div class="order-details">
            <div class="order-detail">
                <span>S·ª± ki·ªán:</span>
                <span>{{ event.name }}</span>
            </div>
            <div class="order-detail">
                <span>Ng√†y:</span>
                <span>{{ event.start_datetime.strftime('%d/%m/%Y %H:%M') if event.start_datetime else 'Ch∆∞a c√≥ th√¥ng tin' }}</span>
            </div>
            <div class="order-detail">
                <span>S·ªë gh·∫ø ƒë√£ ch·ªçn:</span>
                <span>{{ selected_seats|length }} gh·∫ø</span>
            </div>
            <div class="order-detail">
                <span>Gh·∫ø:</span>
                <span>{% for seat in selected_seats %}{% if seat is mapping %}{{ seat.id }}{% else %}{{ seat }}{% endif %}{% if not loop.last %}, {% endif %}{% endfor %}</span>
            </div>
        </div>
        <div class="total-amount">
            T·ªïng ti·ªÅn: {{ "{:,.0f}".format(total_amount) }} VNƒê
        </div>
    </div>

    <div class="payment-methods">
        <h3>üè¶ Ph∆∞∆°ng Th·ª©c Thanh To√°n</h3>
        <div class="payment-options">

            <div class="payment-option" data-method="bank">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjMzQ5OGRiIi8+CjxwYXRoIGQ9Ik0xMCAxNUg1MFYyNUgxMFYxNVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xMCAzMEg1MFY0MEgxMFYzMFoiIGZpbGw9IndoaXRlIi8+CjxjaXJjbGUgY3g9IjMwIiBjeT0iMjAiIHI9IjMiIGZpbGw9IiMzNDk4ZGIiLz4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzNSIgcj0iMyIgZmlsbD0iIzM0OThkYiIvPgo8L3N2Zz4K"
                     alt="Bank Transfer">
                <h4>Chuy·ªÉn Kho·∫£n Ng√¢n H√†ng</h4>
                <p>Chuy·ªÉn kho·∫£n tr·ª±c ti·∫øp qua ng√¢n h√†ng</p>
            </div>

            <div class="payment-option" data-method="momo">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjQzYxNEY2Ii8+CjxwYXRoIGQ9Ik0zMCAxNUMyMS43MTYgMTUgMTUgMjEuNzE2IDE1IDMwQzE1IDM4LjI4NCAyMS43MTYgNDUgMzAgNDVDMzguMjg0IDQ1IDQ1IDM4LjI4NCA0NSAzMEM0NSAyMS43MTYgMzguMjg0IDE1IDMwIDE1Wk0zMCA0MEMyNC40NzcgNDAgMjAgMzUuNTIzIDIwIDMwQzIwIDI0LjQ3NyAyNC40NzcgMjAgMzAgMjBDMzUuNTIzIDIwIDQwIDI0LjQ3NyA0MCAzMEM0MCAzNS41MjMgMzUuNTIzIDQwIDMwIDQwWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTI1IDI1SDM1VjM1SDI1VjI1WiIgZmlsbD0iI0M2MTRGNiIvPgo8L3N2Zz4K"
                     alt="MOMO">
                <h4>MOMO</h4>
                <p>Thanh to√°n qua v√≠ ƒëi·ªán t·ª≠ MOMO</p>
            </div>
        </div>
    </div>

    <!-- QR Code Section -->
    <div class="qr-section" id="qr-section">
        <h3>üì± Qu√©t M√£ QR ƒê·ªÉ Thanh To√°n</h3>
        <div class="payment-instructions">
            <h4>H∆∞·ªõng d·∫´n thanh to√°n:</h4>
            <ul>
                <li>M·ªü ·ª©ng d·ª•ng ng√¢n h√†ng tr√™n ƒëi·ªán tho·∫°i</li>
                <li>Ch·ªçn t√≠nh nƒÉng "Qu√©t m√£ QR"</li>
                <li>Qu√©t m√£ QR b√™n d∆∞·ªõi</li>
                <li>Ki·ªÉm tra th√¥ng tin v√† x√°c nh·∫≠n thanh to√°n</li>
            </ul>
        </div>
        <div class="qr-code">
            <img src="{{ qr_img_url }}" alt="QR Code thanh to√°n" style="width: 200px; height: 200px;"/>
        </div>
        <p><strong>L∆∞u √Ω:</strong> Sau khi thanh to√°n th√†nh c√¥ng, v√© s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n</p>
    </div>

    <!-- Bank Transfer Section -->
    <div class="bank-info" id="bank-info">
        <h3>üè¶ Th√¥ng Tin Chuy·ªÉn Kho·∫£n</h3>
        <div class="payment-instructions">
            <h4>H∆∞·ªõng d·∫´n chuy·ªÉn kho·∫£n:</h4>
            <ul>
                <li>Sao ch√©p th√¥ng tin t√†i kho·∫£n b√™n d∆∞·ªõi</li>
                <li>Chuy·ªÉn kho·∫£n ch√≠nh x√°c s·ªë ti·ªÅn: {{ "{:,.0f}".format(total_amount) }} VNƒê</li>
                <li>N·ªôi dung chuy·ªÉn kho·∫£n: "VE_{{ event.id }}_{{ current_user.id }}"</li>
                <li>Sau khi chuy·ªÉn kho·∫£n, v√© s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n</li>
            </ul>
        </div>
        <div class="bank-details">
            <div class="bank-detail">
                <span>Ng√¢n h√†ng:</span>
                <span>Vietcombank</span>
            </div>
            <div class="bank-detail">
                <span>S·ªë t√†i kho·∫£n:</span>
                <span>1234567890 <button class="copy-btn"
                                         onclick="copyToClipboard('1234567890')">Sao ch√©p</button></span>
            </div>
            <div class="bank-detail">
                <span>Ch·ªß t√†i kho·∫£n:</span>
                <span>C√îNG TY TNHH ƒê·∫∂T V√â ONLINE</span>
            </div>
            <div class="bank-detail">
                <span>S·ªë ti·ªÅn:</span>
                <span>{{ "{:,.0f}".format(total_amount) }} VNƒê</span>
            </div>
            <div class="bank-detail">
                <span>N·ªôi dung:</span>
                <span>VE_{{ event.id }}_{{ current_user.id }} <button class="copy-btn"
                                                                      onclick="copyToClipboard('VE_{{ event.id }}_{{ current_user.id }}')">Sao ch√©p</button></span>
            </div>
        </div>
        <div class="qr-code" style="margin-top: 20px;">
            <img src="{{ qr_img_url_bank }}" alt="QR Code chuy·ªÉn kho·∫£n" style="width: 200px; height: 200px;"/>
<!--            <div><small>Qu√©t m√£ n√†y ƒë·ªÉ chuy·ªÉn kho·∫£n nhanh</small></div>-->
        </div>
    </div>

    <!-- MOMO Section -->
    <div class="qr-section" id="momo-section">
        <h3>üíú Thanh To√°n Qua MOMO</h3>
        <div class="payment-instructions">
            <h4>H∆∞·ªõng d·∫´n thanh to√°n:</h4>
            <ul>
                <li>M·ªü ·ª©ng d·ª•ng MOMO tr√™n ƒëi·ªán tho·∫°i</li>
                <li>Ch·ªçn "Qu√©t m√£ QR" ho·∫∑c "Thanh to√°n"</li>
                <li>Qu√©t m√£ QR b√™n d∆∞·ªõi</li>
                <li>X√°c nh·∫≠n th√¥ng tin v√† ho√†n t·∫•t thanh to√°n</li>
            </ul>
        </div>
        <div class="qr-code">
            <img src="{{ qr_img_url_momo }}" alt="QR Code MOMO" style="width: 200px; height: 200px;"/>
        </div>
        <p><strong>L∆∞u √Ω:</strong> Sau khi thanh to√°n th√†nh c√¥ng, v√© s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n</p>
    </div>

    <div class="payment-actions">
        <button class="btn-pay" onclick="confirmPayment()">‚úÖ X√°c Nh·∫≠n Thanh To√°n</button>
        <button class="btn-cancel" onclick="cancelPayment()">‚ùå H·ªßy B·ªè</button>
    </div>
</div>

<script>
    let selectedMethod = null;

    // X·ª≠ l√Ω ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n
    document.querySelectorAll('.payment-option').forEach(option => {
        option.addEventListener('click', function() {
            // B·ªè ch·ªçn t·∫•t c·∫£
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Ch·ªçn ph∆∞∆°ng th·ª©c n√†y
            this.classList.add('selected');
            selectedMethod = this.dataset.method;

            // ·∫®n t·∫•t c·∫£ section
            document.getElementById('qr-section').classList.remove('active');
            document.getElementById('bank-info').classList.remove('active');
            document.getElementById('momo-section').classList.remove('active');

            // Hi·ªÉn th·ªã section t∆∞∆°ng ·ª©ng
            if (selectedMethod === 'qr') {
                document.getElementById('qr-section').classList.add('active');
            } else if (selectedMethod === 'bank') {
                document.getElementById('bank-info').classList.add('active');
            } else if (selectedMethod === 'momo') {
                document.getElementById('momo-section').classList.add('active');
            }
        });
    });

    // Sao ch√©p v√†o clipboard
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function() {
            alert('ƒê√£ sao ch√©p: ' + text);
        }, function(err) {
            console.error('L·ªói khi sao ch√©p: ', err);
        });
    }

    // X√°c nh·∫≠n thanh to√°n
    function confirmPayment() {
        if (!selectedMethod) {
            alert('Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n!');
            return;
        }

        const paymentData = {
            event_id: {{ event.id }},
            selected_seats: {{ selected_seats|tojson }},
            total_amount: {{ total_amount }},
            payment_method: selectedMethod
        };

        fetch('/process-payment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(paymentData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Thanh to√°n th√†nh c√¥ng! V√© ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n.');
                window.location.href = '{{ url_for("events.my_tickets") }}';
            } else {
                alert('L·ªói: ' + data.message);
            }
        })
        .catch(error => {
            console.error('L·ªói:', error);
            alert('C√≥ l·ªói x·∫£y ra khi x·ª≠ l√Ω thanh to√°n!');
        });
    }

    // H·ªßy thanh to√°n
    function cancelPayment() {
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy thanh to√°n?')) {
            window.location.href = '{{ url_for("events.home") }}';
        }
    }
</script>

<!-- Footer -->
<footer class="footer">
    <div class="footer-content">
        <div class="footer-section">
            <h3>H·ªá Th·ªëng ƒê·∫∑t V√© Online</h3>
            <p>Gi·∫£i ph√°p ƒë·∫∑t v√© tr·ª±c tuy·∫øn hi·ªán ƒë·∫°i v√† ti·ªán l·ª£i</p>
            <p>H·ªó tr·ª£ ƒë·∫∑t v√© cho c√°c s·ª± ki·ªán, concert, v√† show di·ªÖn</p>
        </div>

        <div class="footer-section">
            <h4>Li√™n H·ªá</h4>
            <p>üìß Email: info@ticketing.com</p>
            <p>üìû Hotline: 1900-xxxx</p>
            <p>üè¢ ƒê·ªãa ch·ªâ: 123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM</p>
        </div>

        <div class="footer-section">
            <h4>H·ªó Tr·ª£</h4>
            <p>‚ùì H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</p>
            <p>üìã ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</p>
            <p>üîí Ch√≠nh s√°ch b·∫£o m·∫≠t</p>
            <p>üí≥ H∆∞·ªõng d·∫´n thanh to√°n</p>
        </div>
    </div>

    <div class="footer-bottom">
        <p>¬© 2024 H·ªá Th·ªëng ƒê·∫∑t V√© Online. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        <p>Ph√°t tri·ªÉn b·ªüi Team Ticketing System</p>
    </div>
</footer>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html> 