{% extends "event_organizer/layout_event_organizer/base.html" %}

{% block title %}Ch·ªânh s·ª≠a s·ª± ki·ªán{% endblock %}

{% block content %}
<div class="topbar">
    <h2>{% block header %} Ch·ªânh s·ª≠a s·ª± ki·ªán {% endblock %}</h2>
    <div class="account-wrapper">
        <div class="account" onclick="toggleDropdown()">
            T√†i kho·∫£n <i class="fa fa-caret-down"></i>
        </div>
        <div class="dropdown" id="accountDropdown">
            <a>Th√¥ng tin c√° nh√¢n</a>
            <a>ƒêƒÉng xu·∫•t</a>
        </div>
    </div>
</div>
<div class="form-wrapper">

    <!-- Thanh ti·∫øn tr√¨nh -->
    <div class="step-progress">
        <div class="step active">
            <div class="circle">1</div>
            <div class="label">Th√¥ng tin s·ª± ki·ªán</div>
        </div>
        <div class="step">
            <div class="circle">2</div>
            <div class="label">Th·ªùi gian & Lo·∫°i v√©</div>
        </div>
        <div class="step">
            <div class="circle">3</div>
            <div class="label">Th√¥ng tin thanh to√°n</div>
        </div>
        <div class="step-buttons">
            <button class="btn btn-prev" onclick="goToPrevStep()">Quay l·∫°i</button>
            <button class="btn btn-next" onclick="goToNextStepUpdate()">Ti·∫øp t·ª•c</button>
        </div>
    </div>

    <!-- N·ªôi dung ch√≠nh c√≥ th·ªÉ cu·ªôn -->
    <div class="main-content-scrollable content-center ">
        <div class="content-center">
            <div class="event-form-wrapper">
                <div class="event-form-section step-section step-1 active ">
                    <label class="required-label">
                        <span class="text-danger">*</span> H√¨nh ·∫£nh s·ª± ki·ªán
                    </label>

                    <div class="upload-box" onclick="document.getElementById('imageUpload').click();">
                        <input type="file" id="imageUpload" name="event_image" accept="image/*" style="display: none;"
                               onchange="previewImage(event)">

                        <div id="upload-preview">
                            {% if event and event.image_url %}
                            <img id="preview-img" src="{{ event.image_url }}"
                                 style="max-width: 100%; max-height: 100%; border-radius: 10px;">
                            {% else %}
                            <div>
                                <div class="icon">üì∑</div>
                                <p>Th√™m ·∫£nh s·ª± ki·ªán</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="required-label"><span class="text-danger">*</span> T√™n s·ª± ki·ªán</label>
                        <input type="text" name="name_event" id="name_event" maxlength="100" placeholder="T√™n s·ª± ki·ªán"
                               value="{{ event.name }}">
                        <div class="text-counter">0 / 100</div>
                    </div>

                    <div class="form-group">
                        <label class="required-label">* H√¨nh th·ª©c s·ª± ki·ªán</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="event_format" value="OFFLINE"
                                       {% if is_offline %}checked{% endif %}
                                       onchange="handleEventFormatChange()"> S·ª± ki·ªán Offline
                            </label>
                            <label>
                                <input type="radio" name="event_format" value="ONLINE"
                                       {% if not is_offline %}checked{% endif %}
                                       onchange="handleEventFormatChange()"> S·ª± ki·ªán Online
                            </label>
                        </div>
                    </div>

                    <div class="form-info-event-offline">
                        <div class="form-group">
                            <label class="required-label"><span class="text-danger">*</span> T√™n ƒë·ªãa ƒëi·ªÉm</label>
                            <input type="text" name="venue_name" id="venue_name" maxlength="80"
                                   placeholder="T√™n ƒë·ªãa ƒëi·ªÉm"
                                   value="{{ event.event_offline.venue_name if event.event_offline else '' }}">
                            <div class="text-counter">
                                {{ event.event_offline.venue_name|length if event.event_offline and
                                event.event_offline.venue_name else 0 }} / 80
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="required-label"><span class="text-danger">*</span> ƒê·ªãa ch·ªâ c·ª• th·ªÉ</label>
                            <input type="text" name="address" id="address"
                                   placeholder="ƒê·ªãa ch·ªâ c·ª• th·ªÉ"
                                   value="{{ event.event_offline.location if event.event_offline else '' }}">
                        </div>
                    </div>

                    <div class="form-info-event-online">
                        <div class="form-group">
                            <label class="required-label"><span class="text-danger">*</span> Link tham gia s·ª±
                                ki·ªán</label>
                            <input type="text" name="livestream_url" id="livestream_url" maxlength="80"
                                   placeholder="Link tham gia s·ª± ki·ªán"
                                   value="{{ event.event_online.livestream_url if event.event_online else '' }}">
                            <div class="text-counter">
                                {{ event.event_online.livestream_url|length if event.event_online and
                                event.event_online.livestream_url else 0 }} / 80
                            </div>
                        </div>
                    </div>

                    <div class="form-group form-row">
                        <div>
                            <label class="required-label"><span class="text-danger">*</span> Th·ªÉ lo·∫°i s·ª± ki·ªán</label>
                            <select name="event_type" id="event_type">
                                {% for key, label in event_type.items() %}
                                <option value="{{ key }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="required-label"><span class="text-danger">*</span> Th√¥ng tin s·ª± ki·ªán</label>
                        <textarea name="description" id="description" rows="4"
                                  placeholder="Nh·∫≠p th√¥ng tin...">{{ event.description if event.description else '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label class="required-label"><span class="text-danger">*</span> Lu·∫≠t l·ªá s·ª± ki·ªán</label>
                        <textarea name="rules" id="rules" rows="4"
                                  placeholder="Nh·∫≠p th√¥ng tin...">{{ event.rules if event.rules else '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label class="required-label"><span class="text-danger">*</span> Th√¥ng tin ng∆∞·ªùi bi·ªÉu di·ªÖn s·ª±
                            ki·ªán</label>
                        <textarea name="performers" id="performers" rows="4"
                                  placeholder="Nh·∫≠p th√¥ng tin...">{{ event.authors if event.authors else '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label class="required-label"><span class="text-danger">*</span> Th√¥ng tin ng∆∞·ªùi t·ªï ch·ª©c</label>
                        <textarea name="organizer" id="organizer" rows="4"
                                  placeholder="Nh·∫≠p th√¥ng tin...">{{ event.producers if event.producers else '' }}</textarea>
                    </div>

                </div>

                <div class="event-form-section step-section step-2 ">
                    <h3>Th·ªùi gian s·ª± ki·ªán</h3>
                    <div class="form-group form-row">
                        <div>
                            <label class="required-label">
                                <span class="text-danger">*</span> Ng√†y b·∫Øt ƒë·∫ßu
                            </label>
                            <input type="datetime-local" id="start_time" name="start_time"
                                   value="{{ event.start_datetime.strftime('%Y-%m-%dT%H:%M') if event.start_datetime else '' }}"
                                   required>
                        </div>
                        <div>
                            <label class="required-label">
                                <span class="text-danger">*</span> Ng√†y k·∫øt th√∫c
                            </label>
                            <input type="datetime-local" id="end_time" name="end_time"
                                   value="{{ event.end_datetime.strftime('%Y-%m-%dT%H:%M') if event.end_datetime else '' }}"
                                   required>
                        </div>
                    </div>

                    <h3>Th√¥ng tin c√°c lo·∫°i v√©</h3>
                    <div id="ticket-types">
                        {% if ticket_types %}
                        {% for ticket in ticket_types %}
                        <div class="ticket-type form-group form-row">
                            <div>
                                <label class="required-label">
                                    <span class="text-danger">*</span> T√™n v√©
                                </label>
                                <input type="text" class="ticket_name" name="ticket_name" value="{{ ticket.name }}"
                                       placeholder="V√≠ d·ª•: V√© th∆∞·ªùng">
                            </div>
                            <div>
                                <label class="required-label">
                                    <span class="text-danger">*</span> Gi√° v√© (VNƒê)
                                </label>
                                <input type="number" class="ticket_price" name="ticket_price" min="0"
                                       value="{{ ticket.price }}" placeholder="100000">
                            </div>
                            <div>
                                <label class="required-label">
                                    <span class="text-danger">*</span> S·ªë l∆∞·ª£ng
                                </label>
                                <input type="number" class="ticket_quantity" name="ticket_quantity" min="1"
                                       value="{{ ticket.quantity }}" placeholder="50">
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <!-- N·∫øu ch∆∞a c√≥ v√© n√†o, hi·ªÉn th·ªã 1 d√≤ng tr·ªëng ƒë·ªÉ ng∆∞·ªùi d√πng nh·∫≠p -->
                        <div class="ticket-type form-group form-row">
                            <div>
                                <label class="required-label">
                                    <span class="text-danger">*</span> T√™n v√©
                                </label>
                                <input type="text" class="ticket_name" name="ticket_name"
                                       placeholder="V√≠ d·ª•: V√© th∆∞·ªùng">
                            </div>
                            <div>
                                <label class="required-label">
                                    <span class="text-danger">*</span> Gi√° v√© (VNƒê)
                                </label>
                                <input type="number" class="ticket_price" name="ticket_price" min="0"
                                       placeholder="100000">
                            </div>
                            <div>
                                <label class="required-label">
                                    <span class="text-danger">*</span> S·ªë l∆∞·ª£ng
                                </label>
                                <input type="number" class="ticket_quantity" name="ticket_quantity" min="1"
                                       placeholder="50">
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <button type="button" class="btn btn-save" onclick="addTicketType()">+ Th√™m lo·∫°i v√©</button>
                </div>

                <div class="event-form-section step-section step-3">
                    <h3>Th√¥ng tin thanh to√°n</h3>

                    <div class="form-group">
                        <label class="required-label">Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="payment_method" value="bank" checked
                                       onchange="handlePaymentMethodChange()">
                                Chuy·ªÉn kho·∫£n ng√¢n h√†ng
                            </label>
                            <label>
                                <input type="radio" name="payment_method" value="momo"
                                       onchange="handlePaymentMethodChange()">
                                V√≠ MoMo
                            </label>
                            <label>
                                <input type="radio" name="payment_method" value="vnpay"
                                       onchange="handlePaymentMethodChange()">
                                VNPay
                            </label>
                        </div>
                    </div>

                    <!-- Ng√¢n h√†ng -->
                    <div class="payment-bank">
                        <div class="form-group">
                            <label class="required-label">Ng√¢n h√†ng nh·∫≠n ti·ªÅn</label>
                            <select name="bank">
                                <option value="vcb">Vietcombank</option>
                                <option value="mb">MB Bank</option>
                                <option value="tcb">Techcombank</option>
                                <option value="agribank">Agribank</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="required-label">S·ªë t√†i kho·∫£n</label>
                            <input type="text" name="account_number" placeholder="V√≠ d·ª•: 0123456789">
                        </div>
                        <div class="form-group">
                            <label class="required-label">Ch·ªß t√†i kho·∫£n</label>
                            <input type="text" name="account_holder" placeholder="T√™n ch·ªß t√†i kho·∫£n">
                        </div>
                    </div>

                    <!-- MoMo -->
                    <div class="payment-momo" style="display: none;">
                        <div class="form-group">
                            <label class="required-label">S·ªë ƒëi·ªán tho·∫°i MoMo</label>
                            <input type="text" name="momo_number" placeholder="Nh·∫≠p s·ªë ƒêT li√™n k·∫øt MoMo">
                        </div>
                        <div class="form-group">
                            <label>T√™n ch·ªß t√†i kho·∫£n MoMo</label>
                            <input type="text" name="momo_name" placeholder="T√™n MoMo">
                        </div>
                    </div>

                    <!-- VNPay -->
                    <div class="payment-vnpay" style="display: none;">
                        <div class="form-group">
                            <label class="required-label">M√£ Merchant VNPay</label>
                            <input type="text" name="vnpay_merchant" placeholder="Nh·∫≠p m√£ merchant ID VNPay">
                        </div>
                        <div class="form-group">
                            <label class="required-label">URL callback VNPay</label>
                            <input type="text" name="vnpay_return_url"
                                   placeholder="https://yourdomain.com/vnpay-return">
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>
</div>
<div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>

{% endblock %}
</div>