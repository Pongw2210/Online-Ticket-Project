<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh To√°n - H·ªá Th·ªëng ƒê·∫∑t V√©</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .payment-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .payment-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .payment-header h1 {
            color: #28a745;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .payment-header p {
            color: #34495e;
            font-size: 1.1em;
            font-weight: 500;
        }

        .order-summary {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #28a745;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .order-summary h3 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.4em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .order-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .order-detail {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            color: #2c3e50;
            font-weight: 500;
        }

        .total-amount {
            font-size: 1.5em;
            font-weight: bold;
            color: #28a745;
            text-align: right;
            padding-top: 15px;
            border-top: 3px solid #28a745;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .payment-methods {
            margin-bottom: 30px;
        }

        .payment-methods h3 {
            color: #28a745;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.6em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .payment-option {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .payment-option:hover {
            border-color: #28a745;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .payment-option.selected {
            border-color: #28a745;
            background: linear-gradient(135deg, #ebf3fd, #d6eaf8);
        }

        .payment-option img {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
        }

        .payment-option h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .payment-option p {
            color: #34495e;
            font-size: 0.95em;
            line-height: 1.4;
            font-weight: 500;
        }

        .qr-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
            display: none;
        }

        .qr-section.active {
            display: block;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            color: #666;
        }

        .bank-info {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: none;
        }

        .bank-info.active {
            display: block;
        }

        .bank-details {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .bank-detail {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            color: #2c3e50;
            font-weight: 500;
        }

        .bank-detail:last-child {
            border-bottom: none;
        }

        .copy-btn {
            background: linear-gradient(135deg, #28a745, #2980b9);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f5f8b);
            transform: translateY(-1px);
        }

        .payment-actions {
            text-align: center;
            margin-top: 30px;
        }

        .btn-pay {
            background: linear-gradient(135deg, #28a745, #2980b9);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-pay:hover {
            background: linear-gradient(135deg, #2980b9, #1f5f8b);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn-cancel {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background 0.3s ease;
            margin: 0 10px;
        }

        .btn-cancel:hover {
            background: #7f8c8d;
        }

        .payment-instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .payment-instructions h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .payment-instructions ul {
            color: #2c3e50;
            margin: 0;
            padding-left: 20px;
        }

        .payment-instructions li {
            margin-bottom: 5px;
            font-weight: 500;
        }

        .order-detail span:first-child {
            font-weight: 600;
            color: #2c3e50;
        }

        .order-detail span:last-child {
            color: #2c3e50;
            text-align: right;
            max-width: 60%;
            word-wrap: break-word;
        }

        .qr-section h3, .bank-info h3 {
            color: #28a745;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .bank-detail span:first-child {
            font-weight: 600;
            color: #2c3e50;
        }

        .bank-detail span:last-child {
            color: #2c3e50;
            text-align: right;
        }

        .qr-section p, .bank-info p {
            color: #2c3e50;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .payment-container {
                margin: 20px;
                padding: 20px;
            }

            .order-details {
                grid-template-columns: 1fr;
            }

            .payment-options {
                grid-template-columns: 1fr;
            }

            .btn-pay, .btn-cancel {
                display: block;
                width: 100%;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
<div class="payment-container">
    <div class="payment-header">
        <h1>üí≥ Thanh To√°n</h1>
        <p>Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n ph√π h·ª£p</p>
    </div>

    <div class="order-summary">
        <h3>üìã T√≥m T·∫Øt ƒê∆°n H√†ng</h3>
        <div class="order-details">
            <div class="order-detail">
                <span>S·ª± ki·ªán:</span>
                <span>{{ event.name }}</span>
            </div>
            <div class="order-detail">
                <span>Ng√†y:</span>
                <span>{{ event.date if event.date else 'Ch∆∞a c√≥ th√¥ng tin' }}</span>
            </div>
            <div class="order-detail">
                <span>S·ªë gh·∫ø ƒë√£ ch·ªçn:</span>
                <span>{{ selected_seats|length }} gh·∫ø</span>
            </div>
            <div class="order-detail">
                <span>Gh·∫ø:</span>
                <span>{% for seat in selected_seats %}{% if seat is mapping %}{{ seat.id }}{% else %}{{ seat }}{% endif %}{% if not loop.last %}, {% endif %}{% endfor %}</span>
            </div>
        </div>
        <div class="total-amount">
            T·ªïng ti·ªÅn: {{ "{:,.0f}".format(total_amount) }} VNƒê
        </div>
    </div>

    <div class="payment-methods">
        <h3>üè¶ Ph∆∞∆°ng Th·ª©c Thanh To√°n</h3>
        <div class="payment-options">

            <div class="payment-option" data-method="bank">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjMzQ5OGRiIi8+CjxwYXRoIGQ9Ik0xMCAxNUg1MFYyNUgxMFYxNVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xMCAzMEg1MFY0MEgxMFYzMFoiIGZpbGw9IndoaXRlIi8+CjxjaXJjbGUgY3g9IjMwIiBjeT0iMjAiIHI9IjMiIGZpbGw9IiMzNDk4ZGIiLz4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzNSIgcj0iMyIgZmlsbD0iIzM0OThkYiIvPgo8L3N2Zz4K"
                     alt="Bank Transfer">
                <h4>Chuy·ªÉn Kho·∫£n Ng√¢n H√†ng</h4>
                <p>Chuy·ªÉn kho·∫£n tr·ª±c ti·∫øp qua ng√¢n h√†ng</p>
            </div>

            <div class="payment-option" data-method="momo">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjQzYxNEY2Ii8+CjxwYXRoIGQ9Ik0zMCAxNUMyMS43MTYgMTUgMTUgMjEuNzE2IDE1IDMwQzE1IDM4LjI4NCAyMS43MTYgNDUgMzAgNDVDMzguMjg0IDQ1IDQ1IDM4LjI4NCA0NSAzMEM0NSAyMS43MTYgMzguMjg0IDE1IDMwIDE1Wk0zMCA0MEMyNC40NzcgNDAgMjAgMzUuNTIzIDIwIDMwQzIwIDI0LjQ3NyAyNC40NzcgMjAgMzAgMjBDMzUuNTIzIDIwIDQwIDI0LjQ3NyA0MCAzMEM0MCAzNS41MjMgMzUuNTIzIDQwIDMwIDQwWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTI1IDI1SDM1VjM1SDI1VjI1WiIgZmlsbD0iI0M2MTRGNiIvPgo8L3N2Zz4K"
                     alt="MOMO">
                <h4>MOMO</h4>
                <p>Thanh to√°n qua v√≠ ƒëi·ªán t·ª≠ MOMO</p>
            </div>
        </div>
    </div>

    <!-- QR Code Section -->
    <div class="qr-section" id="qr-section">
        <h3>üì± Qu√©t M√£ QR ƒê·ªÉ Thanh To√°n</h3>
        <div class="payment-instructions">
            <h4>H∆∞·ªõng d·∫´n thanh to√°n:</h4>
            <ul>
                <li>M·ªü ·ª©ng d·ª•ng ng√¢n h√†ng tr√™n ƒëi·ªán tho·∫°i</li>
                <li>Ch·ªçn t√≠nh nƒÉng "Qu√©t m√£ QR"</li>
                <li>Qu√©t m√£ QR b√™n d∆∞·ªõi</li>
                <li>Ki·ªÉm tra th√¥ng tin v√† x√°c nh·∫≠n thanh to√°n</li>
            </ul>
        </div>
        <div class="qr-code">
            <img src="{{ qr_img_url }}" alt="QR Code thanh to√°n" style="width: 200px; height: 200px;"/>
        </div>
        <p><strong>L∆∞u √Ω:</strong> Sau khi thanh to√°n th√†nh c√¥ng, v√© s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n</p>
    </div>

    <!-- Bank Transfer Section -->
    <div class="bank-info" id="bank-info">
        <h3>üè¶ Th√¥ng Tin Chuy·ªÉn Kho·∫£n</h3>
        <div class="payment-instructions">
            <h4>H∆∞·ªõng d·∫´n chuy·ªÉn kho·∫£n:</h4>
            <ul>
                <li>Sao ch√©p th√¥ng tin t√†i kho·∫£n b√™n d∆∞·ªõi</li>
                <li>Chuy·ªÉn kho·∫£n ch√≠nh x√°c s·ªë ti·ªÅn: {{ "{:,.0f}".format(total_amount) }} VNƒê</li>
                <li>N·ªôi dung chuy·ªÉn kho·∫£n: "VE_{{ event.id }}_{{ current_user.id }}"</li>
                <li>Sau khi chuy·ªÉn kho·∫£n, v√© s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n</li>
            </ul>
        </div>
        <div class="bank-details">
            <div class="bank-detail">
                <span>Ng√¢n h√†ng:</span>
                <span>Vietcombank</span>
            </div>
            <div class="bank-detail">
                <span>S·ªë t√†i kho·∫£n:</span>
                <span>1234567890 <button class="copy-btn"
                                         onclick="copyToClipboard('1234567890')">Sao ch√©p</button></span>
            </div>
            <div class="bank-detail">
                <span>Ch·ªß t√†i kho·∫£n:</span>
                <span>C√îNG TY TNHH ƒê·∫∂T V√â ONLINE</span>
            </div>
            <div class="bank-detail">
                <span>S·ªë ti·ªÅn:</span>
                <span>{{ "{:,.0f}".format(total_amount) }} VNƒê</span>
            </div>
            <div class="bank-detail">
                <span>N·ªôi dung:</span>
                <span>VE_{{ event.id }}_{{ current_user.id }} <button class="copy-btn"
                                                                      onclick="copyToClipboard('VE_{{ event.id }}_{{ current_user.id }}')">Sao ch√©p</button></span>
            </div>
        </div>
        <div class="qr-code" style="margin-top: 20px;">
            <img src="{{ qr_img_url_bank }}" alt="QR Code chuy·ªÉn kho·∫£n" style="width: 200px; height: 200px;"/>
<!--            <div><small>Qu√©t m√£ n√†y ƒë·ªÉ chuy·ªÉn kho·∫£n nhanh</small></div>-->
        </div>
    </div>

    <!-- MOMO Section -->
    <div class="qr-section" id="momo-section">
        <h3>üíú Thanh To√°n Qua MOMO</h3>
        <div class="payment-instructions">
            <h4>H∆∞·ªõng d·∫´n thanh to√°n:</h4>
            <ul>
                <li>M·ªü ·ª©ng d·ª•ng MOMO tr√™n ƒëi·ªán tho·∫°i</li>
                <li>Ch·ªçn "Qu√©t m√£ QR" ho·∫∑c "Thanh to√°n"</li>
                <li>Qu√©t m√£ QR b√™n d∆∞·ªõi</li>
                <li>X√°c nh·∫≠n th√¥ng tin v√† ho√†n t·∫•t thanh to√°n</li>
            </ul>
        </div>
        <div class="qr-code">
            <img src="{{ qr_img_url_momo }}" alt="QR Code MOMO" style="width: 200px; height: 200px;"/>
        </div>
        <p><strong>L∆∞u √Ω:</strong> Sau khi thanh to√°n th√†nh c√¥ng, v√© s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n</p>
    </div>

    <div class="payment-actions">
        <button class="btn-pay" onclick="confirmPayment()">‚úÖ X√°c Nh·∫≠n Thanh To√°n</button>
        <button class="btn-cancel" onclick="cancelPayment()">‚ùå H·ªßy B·ªè</button>
    </div>
</div>

<script>
    let selectedMethod = null;

    // X·ª≠ l√Ω ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n
    document.querySelectorAll('.payment-option').forEach(option => {
        option.addEventListener('click', function() {
            // B·ªè ch·ªçn t·∫•t c·∫£
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Ch·ªçn ph∆∞∆°ng th·ª©c n√†y
            this.classList.add('selected');
            selectedMethod = this.dataset.method;

            // ·∫®n t·∫•t c·∫£ section
            document.getElementById('qr-section').classList.remove('active');
            document.getElementById('bank-info').classList.remove('active');
            document.getElementById('momo-section').classList.remove('active');

            // Hi·ªÉn th·ªã section t∆∞∆°ng ·ª©ng
            if (selectedMethod === 'qr') {
                document.getElementById('qr-section').classList.add('active');
            } else if (selectedMethod === 'bank') {
                document.getElementById('bank-info').classList.add('active');
            } else if (selectedMethod === 'momo') {
                document.getElementById('momo-section').classList.add('active');
            }
        });
    });

    // Sao ch√©p v√†o clipboard
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function() {
            alert('ƒê√£ sao ch√©p: ' + text);
        }, function(err) {
            console.error('L·ªói khi sao ch√©p: ', err);
        });
    }

    // X√°c nh·∫≠n thanh to√°n
    function confirmPayment() {
        if (!selectedMethod) {
            alert('Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n!');
            return;
        }

        const paymentData = {
            event_id: {{ event.id }},
            selected_seats: {{ selected_seats|tojson }},
            total_amount: {{ total_amount }},
            payment_method: selectedMethod
        };

        fetch('/process-payment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(paymentData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Thanh to√°n th√†nh c√¥ng! V√© ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn email c·ªßa b·∫°n.');
                window.location.href = '/my-tickets';
            } else {
                alert('L·ªói: ' + data.message);
            }
        })
        .catch(error => {
            console.error('L·ªói:', error);
            alert('C√≥ l·ªói x·∫£y ra khi x·ª≠ l√Ω thanh to√°n!');
        });
    }

    // H·ªßy thanh to√°n
    function cancelPayment() {
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy thanh to√°n?')) {
            window.location.href = '/';
        }
    }
</script>

<!-- Footer -->
<footer class="footer">
    <div class="footer-content">
        <div class="footer-section">
            <h3>H·ªá Th·ªëng ƒê·∫∑t V√© Online</h3>
            <p>Gi·∫£i ph√°p ƒë·∫∑t v√© tr·ª±c tuy·∫øn hi·ªán ƒë·∫°i v√† ti·ªán l·ª£i</p>
            <p>H·ªó tr·ª£ ƒë·∫∑t v√© cho c√°c s·ª± ki·ªán, concert, v√† show di·ªÖn</p>
        </div>

        <div class="footer-section">
            <h4>Li√™n H·ªá</h4>
            <p>üìß Email: info@ticketing.com</p>
            <p>üìû Hotline: 1900-xxxx</p>
            <p>üè¢ ƒê·ªãa ch·ªâ: 123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM</p>
        </div>

        <div class="footer-section">
            <h4>H·ªó Tr·ª£</h4>
            <p>‚ùì H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</p>
            <p>üìã ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</p>
            <p>üîí Ch√≠nh s√°ch b·∫£o m·∫≠t</p>
            <p>üí≥ H∆∞·ªõng d·∫´n thanh to√°n</p>
        </div>
    </div>

    <div class="footer-bottom">
        <p>¬© 2024 H·ªá Th·ªëng ƒê·∫∑t V√© Online. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        <p>Ph√°t tri·ªÉn b·ªüi Team Ticketing System</p>
    </div>
</footer>
</body>
</html> 